#!/bin/bash
# Git pre-commit hook
# í„°ë¯¸ë„/IDEì—ì„œ ì»¤ë°‹í•  ë•Œ ìë™ìœ¼ë¡œ ë¦°íŠ¸ + í…ŒìŠ¤íŠ¸ ì‹¤í–‰

echo "ğŸ” Running pre-commit checks..."

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ ì´ë™
cd "$(git rev-parse --show-toplevel)" || exit 1

# 1. ë¦°íŠ¸ ê²€ì‚¬ (Checkstyle)
echo ""
echo "ğŸ“‹ Step 1/2: Lint check (Checkstyle)..."
./gradlew checkstyleMain --quiet 2>/dev/null

if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Lint check failed!"
    echo "Run './gradlew checkstyleMain' to see details."
    echo "Report: build/reports/checkstyle/main.html"
    exit 1
fi
echo "âœ… Lint check passed!"

# 2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
echo ""
echo "ğŸ§ª Step 2/2: Running tests..."
./gradlew test --quiet

if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Tests failed!"
    echo "Run './gradlew test' to see details."
    exit 1
fi
echo "âœ… All tests passed!"

echo ""
echo "ğŸ‰ All pre-commit checks passed!"
exit 0
